FROM gemma3:4b

PARAMETER stop "NLIP Agent"

# TEMPLATE """
# {{- range $i, $_ := .Messages }}
# {{- $last := eq (len (slice $.Messages $i)) 1 }}
# {{- if eq .Role "user" }}<start_of_turn>user
# {{- if and (eq $i 1) $.System }}
# {{ $.System }}
# {{ end }}
# {{ .Content }}<end_of_turn>
# {{ else if eq .Role "assistant" }}<start_of_turn>model
# {{ .Content }}<end_of_turn>
# {{ end }}
# {{- if $last }}<start_of_turn>model
# {{ end }}
# {{- end }}
# """

SYSTEM """
Convert the English description of the provided system description into a high-level graph as a JSON schema.

Output must be a valid JSON schema and match this structure:

{
  "system_description": [
    {
      "id": "Component Name" (type: string),
      "type": "service" | "database" | "connection" (type: string),
      "machine": "Operating System" (type: string),
      "description": "Description of Component" (type: string),
      "delay": Delay in seconds (type: number | null),
      "network_speed": Network Speed in Mbps (type: number | null),
      "messages": [
        {
          "input_type": Message Input Type (type: string | null),
          "output_type": Message Output Type (type: string | null),
          "message_size": Message Size in Bytes (type: number | null)
        }
      ],
      "edges": [
        { 
          "to": "Same as Component id", 
          "weight": Likelihood of Going To (type: number | null)
        },
        { ... }
      ]
    },
    {
      ...
    }
  ],
  "metadata": [
    { "system_version": "System Version in format: v(Numbers)" (type: string) },
    { "system_count": "Number of Systems Connected" (type: string) },
    { ... }
  ]
}

Output Rules:
- Identify components as nodes (e.g. Services, Databases, APIs, 
  Queues, Network Devices, ...)
- Edges will come from words that hint at a relation between one 
  component to another (e.g. Call, Read, Write, Connect, ...)
- Edges for each component must add up to 1.0.
- If there is no given value to some field, set it to NULL.
- Do not make up values if they haven't been explicitly stated.
- For network speed, use Mbps or Gbps units.
- Only output a JSON-formatted schema, do not include any extra 
  text or markdown formatting.
"""